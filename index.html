<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <h1>QR Code Scanner</h1>
    <div id="reader" style="width: 300px; height: 300px; border: 1px solid black;"></div>
    <input type="text" id="inputField" placeholder="Scanned QR Code Text">
    <button onclick="startScanner('inputField')">Start Scanner</button>

    <script src="script.js"></script>
</body>
</html>
JavaScript (script.js)

async function startScanner(inputFieldId) {
    try {
        // Explicitly request permission first
        const tempStream = await navigator.mediaDevices.getUserMedia({ video: true });
        tempStream.getTracks().forEach(track => track.stop()); // Stop immediately after permission granted

        const devices = await Html5Qrcode.getCameras();
        if (!devices || devices.length === 0) {
            throw new Error("No camera devices found.");
        }

        // Prefer rear camera if available
        let cameraId = devices[0].id; // default to first
        for (const device of devices) {
            if (/back|rear|environment/i.test(device.label)) {
                cameraId = device.id;
                break;
            }
        }

        // Initialize Html5Qrcode
        const html5QrCode = new Html5Qrcode("reader");
        $("#reader").show();

        await html5QrCode.start(
            cameraId,
            { fps: 10, qrbox: 250 },
            decodedText => {
                console.log("Decoded text:", decodedText);
                $(`#${inputFieldId}`).val(decodedText);
                generateQR();
                html5QrCode.stop().then(() => $("#reader").hide());
            },
            errorMessage => {
                console.warn("QR Code scan error:", errorMessage);
            }
        );
    } catch (error) {
        console.error("Camera access or initialization failed:", error);
        alert("Unable to access the camera or initialization failed. " + error.message);
    }
}

function generateQR() {
    // Implement your QR code generation logic here
    console.log("Generating QR code...");
}
